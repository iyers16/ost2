## CLFS Base Log System (Domain)

CLFS (Common Log File System) is a kernel subsystem in Windows used by several services and drivers (TxF, EFS, etc.) to manage high-performance transactional log files.  
A **base log file** contains control, general, and truncate metadata blocks — each with a corresponding **shadow** copy. These are stored as six metadata structures total, used to recover from partial writes.  
Each metadata block has an in-memory representation (`CClfsBaseFile`) that holds an array of `CLFS_METADATA_BLOCK` entries pointing to kernel memory (`pbImage`), along with reference counts.  
Operations like extending, truncating, or reading metadata can involve both normal and shadow blocks — and bugs in how these pointers are swapped or freed can lead to UAFs in kernel space.


