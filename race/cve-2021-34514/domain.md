# CVE-2021-34514

## Domain knowledge

alpc: Windows’ Advanced Local Procedure Call mechanism — basically an optimized IPC channel for kernel↔user and user↔user communication. supports shared memory sections so messages don’t need to be copied between address spaces every time.

shared page: when the ALPC port is configured for “completion lists,” both kernel and user share a memory region where message metadata and bodies are written. anything kernel writes there is instantly visible to the user, and vice versa — so races are possible if kernel trusts data after writing it.

message layout: `_PORT_MESSAGE` contains header fields like `TotalLength`. `_ALPC_COMPLETION_LIST->Data` points to this shared region, and kernel code computes offsets within it (e.g., message + offset + padding) to place metadata or attributes.

race surface: if the kernel writes into shared memory and then later re-reads from it — or computes offsets based on fields that user can change in-between — user can corrupt kernel pointers or cause arbitrary memory writes.

