#include <stdio.h>
#include <stdlib.h>
#include <string.h>

int main(void) {
    /* Example DNS-style name: www.example.com
       Encoded as: [3]'w''w''w'[7]'e'...'e'[3]'c''o''m'[0] */
    unsigned char encoded[] = {
        3, 'w','w','w',
        7, 'e','x','a','m','p','l','e',
        10, 'c','o','m','c','o','m','c','o','m','c','o','m','c','o','m',
        0
    };

    unsigned char *cp = encoded;
    char *out, *np;
    int rc;
    unsigned char len;

    rc = strlen((char *)cp) + 1;
    np = out = malloc(rc);
    if (!out) {
        perror("malloc");
        return 1;
    }

    len = *cp++;
    while (len) {
        while (len--)
            *np++ = *cp++;
        if ((len = *cp++) != 0)
            *np++ = '.';
    }
    *np = '\0';

    printf("Decoded name: %s\n", out);
    free(out);
    return 0;
}
